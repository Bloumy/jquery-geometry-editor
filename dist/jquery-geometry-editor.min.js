!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("turf-polygon");b.exports=function(a){var b=[a[0],a[1]],c=[a[0],a[3]],e=[a[2],a[3]],f=[a[2],a[1]],g=d([[b,f,e,c,b]]);return g}},{"turf-polygon":4}],2:[function(a,b,c){var d=a("turf-meta").coordEach;b.exports=function(a){var b=[1/0,1/0,-(1/0),-(1/0)];return d(a,function(a){b[0]>a[0]&&(b[0]=a[0]),b[1]>a[1]&&(b[1]=a[1]),b[2]<a[0]&&(b[2]=a[0]),b[3]<a[1]&&(b[3]=a[1])}),b}},{"turf-meta":3}],3:[function(a,b,c){function d(a,b,c){var d,e,f,g,h,i,j,k,m,n=0,o="FeatureCollection"===a.type,p="Feature"===a.type,q=o?a.features.length:1;for(d=0;d<q;d++)for(k=o?a.features[d].geometry:p?a.geometry:a,m="GeometryCollection"===k.type,i=m?k.geometries.length:1,g=0;g<i;g++)if(h=m?k.geometries[g]:k,j=h.coordinates,n=!c||"Polygon"!==h.type&&"MultiPolygon"!==h.type?0:1,"Point"===h.type)b(j);else if("LineString"===h.type||"MultiPoint"===h.type)for(e=0;e<j.length;e++)b(j[e]);else if("Polygon"===h.type||"MultiLineString"===h.type)for(e=0;e<j.length;e++)for(f=0;f<j[e].length-n;f++)b(j[e][f]);else{if("MultiPolygon"!==h.type)throw new Error("Unknown Geometry Type");for(e=0;e<j.length;e++)for(f=0;f<j[e].length;f++)for(l=0;l<j[e][f].length-n;l++)b(j[e][f][l])}}function e(a,b,c,e){return d(a,function(a){c=b(c,a)},e),c}function f(a,b){var c;switch(a.type){case"FeatureCollection":for(features=a.features,c=0;c<a.features.length;c++)b(a.features[c].properties);break;case"Feature":b(a.properties)}}function g(a,b,c){return f(a,function(a){c=b(c,a)}),c}b.exports.coordEach=d,b.exports.coordReduce=e,b.exports.propEach=f,b.exports.propReduce=g},{}],4:[function(a,b,c){b.exports=function(a,b){if(null===a)throw new Error("No coordinates passed");for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<d[d.length-1].length;e++){if(d.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(d[d.length-1][e]!==d[0][e])throw new Error("First and last Position are not equivalent.")}var f={type:"Feature",geometry:{type:"Polygon",coordinates:a},properties:b};return f.properties||(f.properties={}),f}},{}],5:[function(a,b,c){var d=a("turf-bbox-polygon"),e=a("./defaultParams.js"),f=a("./util/geometryToSimpleGeometries"),g=a("./util/isSingleGeometryType.js"),h=a("./backend/Backend"),i=function(a,b){this.dataElement=a,this.settings={},$.extend(!0,this.settings,e,b),this.backend=new h({techno:this.settings.techno}),this.map=this.initMap(),this.settings.varMapExport=this.map,this.initDrawLayer(),this.settings.editable&&this.initDrawControls(),this.settings.hide&&this.dataElement.hide(),this.dataElement.on("change",function(){this.updateDrawLayer()}.bind(this))};i.prototype.initMap=function(){return this.backend.initMap({width:this.settings.width,height:this.settings.height,dataElement:this.dataElement,layers:this.settings.tileLayers,lon:this.settings.lon,lat:this.settings.lat,zoom:this.settings.zoom,maxZoom:this.settings.maxZoom,minZoom:this.settings.minZoom})},i.prototype.isDataElementAnInput=function(){return"undefined"!=typeof this.dataElement.val},i.prototype.getRawData=function(){return this.isDataElementAnInput()?$.trim(this.dataElement.val()):$.trim(this.dataElement.html())},i.prototype.setRawData=function(a){var b=this.getRawData();b!==a&&(this.isDataElementAnInput()?this.dataElement.val(a):this.dataElement.html(a),this.dataElement.trigger("change"))},i.prototype.setGeometry=function(a){a instanceof Array&&4===a.length&&(a=d(a).geometry),this.backend.removeFeatures(this.featuresCollection);var b=f(a);this.backend.setGeometries(this.featuresCollection,b),0!==b.length&&this.backend.fitBoundsToMap(this.map,this.featuresCollection),this.serializeGeometry()},i.prototype.initDrawLayer=function(){this.featuresCollection=this.backend.createFeaturesCollection(this.map),this.updateDrawLayer(),this.dataElement.on("change",this.updateDrawLayer.bind(this))},i.prototype.updateDrawLayer=function(){var a,b=this.getRawData();if(""!==b){try{a=JSON.parse(b)}catch(c){return void this.backend.removeFeatures(this.featuresCollection)}this.setGeometry(a)}},i.prototype.getGeometryType=function(){return this.settings.geometryType},i.prototype.canEdit=function(a){return"Rectangle"===a&&this.getGeometryType().indexOf("Polygon")!==-1||("Geometry"===this.getGeometryType()||("GeometryCollection"===this.getGeometryType()||this.getGeometryType().indexOf(a)!==-1))},i.prototype.initDrawControls=function(){var a={geometryType:this.getGeometryType(),features:this.featuresCollection};this.backend.addDrawControlToMap(this.map,a);var b={onDrawCreated:function(a){g(this.getGeometryType())&&this.backend.removeFeatures(this.featuresCollection),this.backend.addFeaturesToLayer(this.featuresCollection,a.layer),this.serializeGeometry()}.bind(this),onDrawModified:function(a){this.serializeGeometry()}.bind(this),onDrawDeleted:function(a){this.serializeGeometry()}.bind(this)};this.backend.addDrawEventsToMap(this.map,b)},i.prototype.serializeGeometry=function(){var a=this.backend.getGeoJsonGeometry(this.featuresCollection,this.getGeometryType());this.setRawData(a)},b.exports=i},{"./backend/Backend":6,"./defaultParams.js":9,"./util/geometryToSimpleGeometries":12,"./util/isSingleGeometryType.js":14,"turf-bbox-polygon":1}],6:[function(a,b,c){var d=a("../util/guid"),e=a("./Leaflet"),f=a("./OpenLayers"),g=function(a){switch(a=a||{techno:"Leaflet"},a.techno){case"Leaflet":this.techno=new e;break;case"Openlayers":this.techno=new f}};g.prototype.initMap=function(a){var b="map-"+d(),c=$('<div id="'+b+'"></div>');c.addClass("map"),c.css("width",a.width),c.css("height",a.height),c.insertAfter(a.dataElement);var e=this.techno.createMap(b,a);return this.techno.addLayersToMap(e,a.layers),e},g.prototype.addControlToMap=function(a,b){this.techno.addControlToMap(a,b)},g.prototype.setGeometries=function(a,b){this.techno.setGeometries(a,b)},g.prototype.fitBoundsToMap=function(a,b){this.techno.fitBoundsToMap(a,b)},g.prototype.createFeaturesCollection=function(a){return this.techno.createFeaturesCollection(a)},g.prototype.addFeaturesToLayer=function(a,b){this.techno.addFeaturesToLayer(a,b)},g.prototype.removeFeatures=function(a){this.techno.removeFeatures(a)},g.prototype.addDrawControlToMap=function(a,b){this.techno.addDrawControlToMap(a,b)},g.prototype.addDrawEventsToMap=function(a,b){this.techno.addDrawEventsToMap(a,b)},g.prototype.getGeoJsonGeometry=function(a,b){return this.techno.getGeoJsonGeometry(a,b)},b.exports=g},{"../util/guid":13,"./Leaflet":7,"./OpenLayers":8}],7:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.L:"undefined"!=typeof c?c.L:null,e="undefined"!=typeof window?window.L.Control.Draw:"undefined"!=typeof c?c.L.Control.Draw:null,f=a("./../util/featureCollectionToGeometry.js"),g=a("turf-extent"),h=function(a){this.settings={},$.extend(this.settings,a)};h.prototype.createMap=function(a,b){b=b||{};var c=d.map(a).setView([b.lat,b.lon],b.zoom);return c},h.prototype.addLayersToMap=function(a,b,c){c=c||{};for(var e in b){var f=b[e];d.tileLayer(f.url,{attribution:f.attribution,maxZoom:c.maxZoom||18}).addTo(a)}},h.prototype.addControlToMap=function(a,b){a.addControl(b)},h.prototype.setGeometries=function(a,b){d.geoJson(b,{onEachFeature:function(b,c){a.addLayer(c)}})},h.prototype.fitBoundsToMap=function(a,b){a.fitBounds(b.getBounds())},h.prototype.createFeaturesCollection=function(a){return d.featureGroup().addTo(a)},h.prototype.removeFeatures=function(a){a.clearLayers()},h.prototype.addFeaturesToLayer=function(a,b){a.addLayer(b)},h.prototype.addDrawControlToMap=function(a,b){var c={draw:{position:"topleft",marker:this.canEdit(b.geometryType,"Point"),polyline:this.canEdit(b.geometryType,"LineString"),polygon:this.canEdit(b.geometryType,"Polygon"),rectangle:this.canEdit(b.geometryType,"Rectangle"),circle:!1},edit:{featureGroup:b.features}},d=new e(c);a.addControl(d)},h.prototype.addDrawEventsToMap=function(a,b){a.on("draw:created",b.onDrawCreated),a.on("draw:edited",b.onDrawModified),a.on("draw:deleted",b.onDrawDeleted)},h.prototype.canEdit=function(a,b){return"Rectangle"===b&&a.indexOf("Polygon")!==-1||("Geometry"===a||("GeometryCollection"===a||a.indexOf(b)!==-1))},h.prototype.getGeoJsonGeometry=function(a,b){var c=f(a.toGeoJSON());return c?"Rectangle"===b?JSON.stringify(g(c)):JSON.stringify(c):""},b.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./../util/featureCollectionToGeometry.js":10,"turf-extent":2}],8:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.ol:"undefined"!=typeof c?c.ol:null,e=a("../util/openlayers/DrawControl"),f=function(a){this.settings={dataProjection:"EPSG:4326",mapProjection:"EPSG:3857"},$.extend(this.settings,a)};f.prototype.createMap=function(a,b){b=b||{};var c=new d.Map({target:a,view:new d.View({center:d.proj.transform([b.lon,b.lat],this.settings.dataProjection,this.settings.mapProjection),zoom:b.zoom,minZoom:b.minZoom,maxZoom:b.maxZoom,projection:this.settings.mapProjection}),controls:[]});return c},f.prototype.addLayersToMap=function(a,b,c){c=c||{};for(var e in b)a.addLayer(new d.layer.Tile({source:new d.source.XYZ({attributions:[b[e].attribution],url:b[e].url,crossOrigin:"Anonymous"})}))},f.prototype.addControlToMap=function(a,b){a.addControl(b)},f.prototype.setGeometries=function(a,b){for(var c in b){var e;switch(b[c].type){case"Point":e=new d.geom.Point(b[c].coordinates);break;case"LineString":e=new d.geom.LineString(b[c].coordinates);break;case"Polygon":e=new d.geom.Polygon(b[c].coordinates)}var f=new d.Feature({geometry:e.transform(this.settings.dataProjection,this.settings.mapProjection)});a.push(f)}},f.prototype.fitBoundsToMap=function(a,b){a.getView().fit(b.getArray()[0].getGeometry(),a.getSize())},f.prototype.createFeaturesCollection=function(a){var b=new d.Collection;return a.addLayer(new d.layer.Vector({source:new d.source.Vector({features:b})})),b},f.prototype.removeFeatures=function(a){a.clear()},f.prototype.addFeaturesToLayer=function(a,b){b.addFeatures(a)},f.prototype.addDrawControlToMap=function(a,b){var c={},d=new e(c);a.addControl(d)},f.prototype.addDrawEventsToMap=function(a,b){a.on("draw:created",b.onDrawCreated),a.on("draw:edited",b.onDrawModified),a.on("draw:deleted",b.onDrawDeleted)},f.prototype.getGeoJsonGeometry=function(a,b){var c=a.getArray()[0].getGeometry().clone();return(new d.format.GeoJSON).writeGeometry(c.transform(this.settings.mapProjection,this.settings.dataProjection))},b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util/openlayers/DrawControl":15}],9:[function(a,b,c){var d={techno:"Leaflet",tileLayers:[{url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}],hide:!0,editable:!0,width:"100%",height:"500",lon:2,lat:45,zoom:4,maxZoom:18,geometryType:"Geometry"};b.exports=d},{}],10:[function(a,b,c){var d=a("./geometriesToCollection.js"),e=function(a){var b=[];return a.features.forEach(function(a){b.push(a.geometry)}),0===b.length?null:1==b.length?b[0]:d(b)};b.exports=e},{"./geometriesToCollection.js":11}],11:[function(a,b,c){var d=function(a){var b={};a.forEach(function(a){"undefined"==typeof b[a.type]?b[a.type]=1:b[a.type]++});var c=Object.keys(b);if(c.length>1)return{type:"GeometryCollection",geometries:a};var d="Multi"+Object.keys(b)[0],e=[];return a.forEach(function(a){e.push(a.coordinates)}),{type:d,coordinates:e}};b.exports=d},{}],12:[function(a,b,c){var d=function(a){var b=[],c=a.type.substring("Multi".length);return a.coordinates.forEach(function(a){b.push({type:c,coordinates:a})}),b},e=function(a){var b=[];return a.geometries.forEach(function(a){b.push(a)}),b},f=function(a){switch(a.type){case"Point":case"LineString":case"Polygon":return[a];case"MultiPoint":case"MultiLineString":case"MultiPolygon":return d(a);case"GeometryCollection":return e(a);default:throw"unsupported geometry type : "+a.type}};b.exports=f},{}],13:[function(a,b,c){var d=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};b.exports=d},{}],14:[function(a,b,c){var d=function(a){return["Point","LineString","Polygon","Rectangle"].indexOf(a)!==-1};b.exports=d},{}],15:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.ol:"undefined"!=typeof a?a.ol:null,d=function(a){var b={featuresCollection:null,type:"",title:"",hitTolerance:10,onDrawStart:function(){},onDrawEnd:function(){},onDeactivate:function(){},onActivate:function(){}};this.settings=$.extend(b,a),this.active=!1;var d=$("<div>").addClass("ol-draw-"+this.settings.type.toLowerCase()+" ol-unselectable ol-control"),e=this;$("<button>").attr("title",this.settings.title).on("touchstart click",function(a){a&&a.preventDefault&&a.preventDefault(),e.setActive(!e.active)}).html('<span class="glyphicon gpu-draw-'+this.settings.type.toLowerCase()+'"></span>').appendTo(d),c.control.Control.call(this,{element:d.get(0),target:a.target}),this.drawInteraction=this.createDrawInteraction()};c.inherits(d,c.control.Control),d.prototype.setMap=function(a){c.control.Control.prototype.setMap.call(this,a),this.initControl()},d.prototype.initControl=function(){this.getMap().addInteraction(this.drawInteraction),this.drawInteraction.setActive(!1)},d.prototype.setActive=function(a){a&&!this.active&&($(this).trigger("activate"),this.settings.onActivate(this),this.getMap().addInteraction(this.drawInteraction),this.drawInteraction.setActive(!0),this.active=!0,$(this.element).addClass("active")),!a&&this.active&&($(this).trigger("deactivate"),this.settings.onDeactivate(this),this.drawInteraction.setActive(!1),this.active=!1,$(this.element).removeClass("active"))},d.prototype.createDrawInteraction=function(){var a=null;switch(this.settings.type){case"Point":a="Point";break;case"Text":a="Point";break;case"LineString":a="LineString";break;case"Polygon":a="Polygon"}var b=new c.interaction.Draw({type:a,features:this.settings.featuresCollection,style:this.settings.styleWhenDrown}),d=this;return b.on("drawstart",this.settings.onDrawStart),b.on("drawend",function(a){a.feature.setStyle(d.settings.styleWhenAdded),a.feature.setProperties({gpuGeometryType:d.settings.type}),d.settings.onDrawEnd(a)}),b},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],16:[function(a,b,c){(function(b){var c="undefined"!=typeof window?window.jQuery:"undefined"!=typeof b?b.jQuery:null,d={defaultParams:a("./ge/defaultParams"),GeometryEditor:a("./ge/GeometryEditor")};c.fn.geometryEditor=function(a){return this.each(function(){var b=$(this),c=new d.GeometryEditor(b,a);b.data("editor",c)})},b.ge=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ge/GeometryEditor":5,"./ge/defaultParams":9}]},{},[16]);